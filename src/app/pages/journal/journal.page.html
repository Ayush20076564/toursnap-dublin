<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button routerLink="/places">
        <ion-icon slot="icon-only" name="map-outline"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title>
      <ion-icon name="book-outline" class="title-icon"></ion-icon>
      Journal
    </ion-title>

    <ion-buttons slot="end">
      <ion-button routerLink="/safety">
        <ion-icon slot="icon-only" name="shield-checkmark-outline"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <div class="page-pad">
    <ion-card *ngIf="!(entries?.length)">
      <ion-card-content class="empty">
        <ion-icon name="albums-outline" class="empty-icon"></ion-icon>
        <h2>No journal entries yet</h2>
        <p>Go to Places → open a place → Add to Journal.</p>
        <ion-button expand="block" routerLink="/places">
          <ion-icon slot="start" name="map-outline"></ion-icon>
          Explore Places
        </ion-button>
      </ion-card-content>
    </ion-card>

    <ion-list *ngIf="entries?.length">
      <ion-item
        *ngFor="let e of entries"
        lines="full"
        detail="false"
        (click)="openEntry(e)"
      >
        <ion-thumbnail slot="start" *ngIf="(e.photoSrcs?.length || 0) > 0">
          <img [src]="e.photoSrcs[0]" alt="journal photo" />
        </ion-thumbnail>

        <ion-label>
          <h2 class="place-title">{{ e.placeName }}</h2>
          <p class="note" *ngIf="e.note">{{ e.note }}</p>
          <p class="small">{{ e.createdAt | date : 'medium' }}</p>
        </ion-label>

        <ion-button
          fill="clear"
          slot="end"
          (click)="$event.stopPropagation(); openEntry(e)"
        >
          <ion-icon name="expand-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </ion-item>
    </ion-list>

    <!-- Expanded Modal -->
    <ion-modal [isOpen]="isModalOpen" (didDismiss)="isModalOpen = false; selected = null;">
      <ng-template>
        <ion-header>
          <ion-toolbar>
            <ion-title>{{ selected?.placeName || 'Entry' }}</ion-title>
            <ion-buttons slot="end">
              <ion-button (click)="closeModal()">
                <ion-icon name="close-outline" slot="icon-only"></ion-icon>
              </ion-button>
            </ion-buttons>
          </ion-toolbar>
        </ion-header>

        <ion-content class="page-pad">
          <ion-card *ngIf="selected">
            <ion-card-header>
              <ion-card-title>{{ selected.placeName }}</ion-card-title>
              <ion-card-subtitle>
                {{ selected.createdAt | date : 'fullDate' }}
              </ion-card-subtitle>
            </ion-card-header>

            <ion-card-content>
              <p class="note-full" *ngIf="selected.note">{{ selected.note }}</p>

              <div class="photo-grid" *ngIf="(selected.photoSrcs?.length || 0) > 0">
                <div class="photo" *ngFor="let s of selected.photoSrcs">
                  <img [src]="s" alt="photo" />
                </div>
              </div>

              <p class="muted" *ngIf="(selected.photoSrcs?.length || 0) === 0">
                No photos saved for this entry.
              </p>

              <div class="actions">
                <ion-button expand="block" fill="outline" (click)="editSelected()">
                  <ion-icon name="create-outline" slot="start"></ion-icon>
                  Edit Journal
                </ion-button>

                <ion-button expand="block" color="danger" (click)="askDeleteSelected()">
                  <ion-icon name="trash-outline" slot="start"></ion-icon>
                  Delete
                </ion-button>
              </div>
            </ion-card-content>
          </ion-card>
        </ion-content>
      </ng-template>
    </ion-modal>
  </div>
</ion-content>
